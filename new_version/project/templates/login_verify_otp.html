{% extends 'layout.html' %}
{% block content %}
<section class="form-shell anim-fade-in anim-delay-2">
    <form class="form-card" method="POST" action="">
        <input type="hidden" name="csrf_token" value="{{ csrf_token }}">
        <h1>Подтверждение входа</h1>
        <p class="hint-line">Код отправлен на {{ user_email_masked }}</p>
        <div class="field">
            <label>Код подтверждения</label>
            <input class="input-styled" type="text" name="otp_code" maxlength="6" pattern="[0-9]{6}" inputmode="numeric" autocomplete="one-time-code" required autofocus>
        </div>
        <button class="btn btn-primary" type="submit">Подтвердить</button>
        {% if mes %}<p class="mes-line">{{ mes }}</p>{% endif %}
        <hr class="hr">
    </form>
    <form class="form-card" method="POST" action="">
        <input type="hidden" name="csrf_token" value="{{ csrf_token }}">
        <input type="hidden" name="action" value="resend">
        <button class="btn btn-secondary" id="resend-btn" type="submit"{% if resend_cooldown > 0 %} disabled{% endif %}>Отправить повторно</button>
        <p class="hint-line"><a href="/login/new/">Вернуться на страницу входа</a></p>
    </form>
</section>
{% endblock %}
{% block scripts %}
<script>
(function() {
    var btn = document.getElementById('resend-btn');
    var cooldown = {{ resend_cooldown | default(0) }};
    if (cooldown > 0 && btn) {
        btn.disabled = true;
        var orig = btn.textContent;
        var timer = setInterval(function() {
            cooldown--;
            btn.textContent = 'Отправить повторно (' + cooldown + ')';
            if (cooldown <= 0) {
                clearInterval(timer);
                btn.disabled = false;
                btn.textContent = orig;
            }
        }, 1000);
    }
})();
</script>
{% endblock %}
