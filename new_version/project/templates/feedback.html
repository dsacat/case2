{% extends 'layout.html' %}
{% block content %}
<section class="feedback-grid anim-fade-in anim-delay-2">
    <form class="panel form-block" method="POST" action="">
        <input type="hidden" name="csrf_token" value="{{ csrf_token }}">
        <h2>Новое обращение</h2>
        <div class="field {% if field_errors.subject %}field-error{% endif %}"><label>Тема</label><input class="input-styled" type="text" name="subject" value="{{ form_data.subject | default('') }}" maxlength="200" required></div>
        <div class="field {% if field_errors.body %}field-error{% endif %}"><label>Сообщение</label><textarea class="input-styled" name="body" maxlength="5000" required>{{ form_data.body | default('') }}</textarea></div>
        <button class="btn btn-primary" type="submit">Отправить</button>
    </form>
    <div class="panel">
        <h3>{% if is_moder %}Все обращения{% else %}Мои обращения{% endif %}</h3>
        <div class="table-wrap">
            <table>
                <thead><tr><th>ID</th><th>Тема</th><th>Статус</th><th>Обновлено</th><th></th></tr></thead>
                <tbody>
                {% for row in threads %}
                <tr>
                    <td>{{ row.id }}</td>
                    <td>{{ row.subject }}</td>
                    <td>{% if row.status == 'open' %}Открыто{% elif row.status == 'closed' %}Закрыто{% else %}{{ row.status }}{% endif %}</td>
                    <td>{{ row.updated_at.strftime('%d.%m.%Y %H:%M') }}</td>
                    <td><a class="btn btn-primary btn-sm" href="/feedback/{{ row.id }}/">Открыть</a></td>
                </tr>
                {% else %}
                <tr><td colspan="5">Обращений пока нет.</td></tr>
                {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</section>
{% endblock %}
