{% extends 'layout.html' %}
{% block content %}
<section class="form-shell anim-fade-in anim-delay-2">
    <form class="form-card wide" method="POST" enctype="multipart/form-data" action="">
        <input type="hidden" name="csrf_token" value="{{ csrf_token }}">
        <h1>Добавление блюда</h1>
        <div class="field {% if field_errors.dish_title %}field-error{% endif %}"><label>Название</label><input class="input-styled" name="dish_title" maxlength="220" value="{{ form_data.dish_title }}" required></div>
        <div class="field {% if field_errors.dish_description %}field-error{% endif %}"><label>Описание</label><textarea class="input-styled" name="dish_description" maxlength="2000" required>{{ form_data.dish_description }}</textarea></div>
        <div class="field {% if field_errors.dish_composition %}field-error{% endif %}"><label>Состав</label><textarea class="input-styled" name="dish_composition" maxlength="2000" required>{{ form_data.dish_composition }}</textarea></div>
        <div class="field"><label>Аллергены</label><input type="text" name="allergens" maxlength="500" class="input-styled" value="{{ form_data.allergens | default('') }}" placeholder="глютен, лактоза, орехи (через запятую)"></div>
        <div class="field"><label>Категория</label>
            <select class="input-styled" name="dish_category">
                {% for key, title in categories.items() %}
                <option value="{{ key }}" {% if form_data.dish_category == key %}selected{% endif %}>{{ title }}</option>
                {% endfor %}
            </select>
        </div>
        <div class="field-grid">
            <div class="field {% if field_errors.dish_group_id %}field-error{% endif %}"><label>Группа меню</label>
                <select class="input-styled" name="dish_group_id">
                    <option value="0" {% if form_data.dish_group_id == '0' %}selected{% endif %}>Без отдельной группы</option>
                    {% for row in dish_groups %}
                    <option value="{{ row.id }}" {% if form_data.dish_group_id == (row.id|string) %}selected{% endif %}>{{ row.title }}</option>
                    {% endfor %}
                </select>
                <p class="hint-line"><a href="/create_menu_group/">Создать группу отдельно</a></p>
            </div>
            <div class="field {% if field_errors.dish_group_new %}field-error{% endif %}"><label>Новая группа (опционально)</label><input class="input-styled" name="dish_group_new" maxlength="120" value="{{ form_data.dish_group_new }}" placeholder="Например, Диетическое меню"></div>
        </div>
        <div class="field-grid four">
            <div class="field {% if field_errors.dish_mass %}field-error{% endif %}"><label>Масса, г</label><input class="input-styled" type="number" step="0.1" min="0" name="dish_mass" value="{{ form_data.dish_mass }}" required></div>
            <div class="field {% if field_errors.dish_kcal %}field-error{% endif %}"><label>Ккал</label><input class="input-styled" type="number" step="0.1" min="0" name="dish_kcal" value="{{ form_data.dish_kcal }}" required></div>
            <div class="field {% if field_errors.dish_proteins %}field-error{% endif %}"><label>Белки</label><input class="input-styled" type="number" step="0.1" min="0" name="dish_proteins" value="{{ form_data.dish_proteins }}" required></div>
            <div class="field {% if field_errors.dish_fats %}field-error{% endif %}"><label>Жиры</label><input class="input-styled" type="number" step="0.1" min="0" name="dish_fats" value="{{ form_data.dish_fats }}" required></div>
        </div>
        <div class="field-grid">
            <div class="field {% if field_errors.dish_carbs %}field-error{% endif %}"><label>Углеводы</label><input class="input-styled" type="number" step="0.1" min="0" name="dish_carbs" value="{{ form_data.dish_carbs }}" required></div>
            <div class="field {% if field_errors.dish_price %}field-error{% endif %}"><label>Цена, ₽</label><input class="input-styled" type="number" min="0" step="1" name="dish_price" value="{{ form_data.dish_price }}" required></div>
        </div>
        <div class="field"><label>Картинка (необязательно)</label><input class="input-styled" type="file" accept="image/*" name="dish_image"></div>
        <button class="btn btn-primary" type="submit">Сохранить блюдо</button>
        {% if mes %}<p class="mes-line">{{ mes }}</p>{% endif %}
    </form>
</section>
{% endblock %}
